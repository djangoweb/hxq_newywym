{template 'header'}
<style>
html{ width:100%; height:100%;margin:0px; padding:0px;font-family:'微软雅黑'; font-size: 10px;}
body{ width:100%; height:100%;margin:0px; padding:0px;font-size: 10px;font-family:'微软雅黑';position: relative;background-size:100% 100% ;background-image: url('{php echo $_W['attachurl']}{$act['page']['share']}');}
a.more:link{  height: 16px;  padding: 1px 4px; font-size: 1.4rem;  border-radius:2px;background: #fed700; color: #6e2020; text-align: center;}
a.more:hover{  height: 16px;  padding: 1px 4px; font-size: 1.4rem;  border-radius:2px;background: #fed700; color: #6e2020; text-align: center;}

.more{height: 18px ; display: inline-block;  line-height:14px; font-size:1.4rem;color: #000； padding:2 4px; }
*{box-sizing:border-box}
.openbox{height:75%;margin:auto; width: 85% ;margin:20px auto 5px auto;padding:0px;list-style:none ;background:url('{MODULE_URL}/images/rpopen.png');background-size:100% 100% ;position: relative;}
.openbox>.msg{line-height: 24px;text-align: left;width: 70%;margin:5px auto;color:#000;}
.openbox>.thumb{line-height: 24px;text-align: left;width: 80%;margin:auto;color:#fff;position: absolute;top:40%;left:0px;right: 0px;margin: auto}
.openbox>.thumb>img{ width: 40% }
.openbox>.message{margin:5px auto 0px auto;line-height: 24px;text-align: left;width: 70%;color:#000;font-size: 14px; border-bottom:1px dashed #ccc; }
.openbox>.redpack1{ width:80%;height:100px; color:red;font-size:20px; text-align: center;position: absolute;top: 12%;line-height: 100px;left: 0px;right: 0px;margin: auto}
.openbox>.redpack3{ width:80%;height:30px; line-height: 30px; margin:5px auto;color:red;font-size: 20px; text-align: center;left: 0px;right: 0px;margin: auto}
.openbox>.redtip{ width: 80%;color:#fff;font-size:14px;line-height:24px;padding: 5px; top:40%;left: 0px;right: 0px;margin: auto;position: absolute;}
.openbox>.greentip{ width: 80%;color:#fff;font-size:14px;line-height: 24px; padding: 5px;top:65%;left: 0px;right: 0px;margin: auto ;position: absolute;}
.openbox>.msgfooter{ text-align: center;width: 80%;position: absolute;top:65%;left: 0px;right: 0px;margin: auto}

.openbox>.msgfooter>a>img{width:  100% }
.openbox>.msgfooter2{ text-align: center;width:80%;position: absolute;top:80%;left: 0px;right: 0px;margin: auto}
.icon{ display: inline-block;  width: 25px; height: 25px; background:url({MODULE_URL}images/icons.png) ; }
.icontip{background-position: -50px -50px;}
.wxtips{ position: absolute;bottom:5px;width: 75%; margin:auto;text-align: center; left: 0px; right: 0px;}
a.button:link{ padding: 0px 10px;min-width:100px;height:35px;line-height: 35px; background: #fed700; border-radius: 200px; color:#6e2020;box-shadow:0 4px 0 #f09e00, 0 5px 3px rgba(0, 0, 0, 0.3); text-align: center;display:inline-block;font-size: 1.4rem;}
a.button:hover{ padding: 0px 10px;min-width:100px;height:35px;line-height: 35px; background: #fed700; border-radius: 200px; color:#6e2020;box-shadow:0 4px 0 #f09e00, 0 5px 3px rgba(0, 0, 0, 0.3); text-align: center;display:inline-block;font-size: 1.4rem;}
a.button:visited{ padding: 0px 10px;min-width:100px;height:35px;line-height: 35px; background: #fed700; border-radius: 200px; color:#6e2020;box-shadow:0 4px 0 #f09e00, 0 5px 3px rgba(0, 0, 0, 0.3); text-align: center;display:inline-block;font-size: 1.4rem;}
input.large{ width: 100%;font-size: 1.4rem }
a.large{width: 100%; font-size: 1.4rem;}
input.danger{ background: #f44040; color:#fff;box-shadow:0 4px 0 #ca0909, 0 5px 3px rgba(0, 0, 0, 0.3);}
input.success{ background: #5cb85c; color:#fff;box-shadow:0 4px 0 #2d962d, 0 5px 3px rgba(0, 0, 0, 0.3);}
a.danger:link{ background: #f44040; color:#fff;box-shadow:0 4px 0 #ca0909, 0 5px 3px rgba(0, 0, 0, 0.3); }
a.danger:hover{ background: #f44040 ;color:#fff;box-shadow:0 4px 0 #ca0909, 0 5px 3px rgba(0, 0, 0, 0.3); }
a.danger:visited{ background: #f44040; color:#fff; box-shadow:0 4px 0 #ca0909, 0 5px 3px rgba(0, 0, 0, 0.3); }
a.success:link{ background: #5cb85c; color:#fff;box-shadow:0 4px 0 #2d962d, 0 5px 3px rgba(0, 0, 0, 0.3); }
a.success:hover{ background: #5cb85c ;color:#fff;box-shadow:0 4px 0 #2d962d, 0 5px 3px rgba(0, 0, 0, 0.3); }
a.success:visited{ background: #5cb85c;color:#fff; box-shadow:0 4px 0 #2d962d, 0 5px 3px rgba(0, 0, 0, 0.3); }
a.disable:link{ padding: 0px 10px;height:35px;line-height: 35px; background: #fcdea3; border-radius: 200px; color:#6e2020;box-shadow:0 4px 0 #facf7d, 0 5px 3px rgba(0, 0, 0, 0.3); text-align: center;display:inline-block}
a.disable:visited{ padding: 0px 10px;height:35px;line-height: 35px; background: #fcdea3; border-radius: 200px; color:#6e2020;box-shadow:0 4px 0 #facf7d, 0 5px 3px rgba(0, 0, 0, 0.3); text-align: center;display:inline-block}
.credit1{position: absolute;bottom:10px; width:60%;margin: auto;line-height: 20px;text-align:center;color:#fff;left: 0px;right:0px;font-size: 1.4rem}
.top{ height:25%; background: orange }
.top img{ width:100%; }
.corpright{height: 40px;line-height: 40px;text-align: center;}
.sthumb{width:280px;height: 370px;margin:auto;background: url('http://wx.wecould.cc/addons/hxq_ywym/images/rpbg.png');background-size:100% 100%;text-align:center; padding-top:1px; }
.sthumb>.row1{ margin:10px auto 10px auto; list-style: none;  overflow: hidden;font-size: 1.4rem;color:#fff; width:80%;line-height: 24px;height:72px;text-align: left}
.sthumb>.row2{ margin:10px auto 10px auto; list-style: none;  overflow: hidden;font-size: 1.4rem;color:#fff; width:80%;line-height: 20px;height:60px;}
.sthumb>.row3{text-align:center;list-style: none;  font-size: 1.4rem;width: 80%;margin:10px auto;color: #fff;line-height: 24px;overflow: hidden;white-space: normal;}
</style>
<script>
var pagename='share';
var locationurl='{php echo $this->createmobileurl('index')}'
var posiurl='{php echo $this->createmobileurl('position')}'
var dscan={$_M['cate']['dscan']};
var dscanwarning={$_M['cate']['dscanwarning']};
var forcegetlocation={$_M['cate']['forcegetlocation']};
var tk='{$_GPC['tk']}';
{if !empty($_M['cate']['districtarr'])}
var districtarr={php echo json_encode($_M['cate']['districtarr'])};
{/if}
var strDistrict='{$_M['cate']['strDistrict']}'
{if $_M['qr']}
var istoken=true;
{else}
var istoken=false;
{/if}
scanid={if $_GPC['scanid']}{$_GPC['scanid']}{else}0{/if};
</script>
<div class="share" style="width: 100%; height: 100%;background: rgba(0,0,0,0.6); color: #fff;padding-top:1px;">
<div class="sctnt" style="margin-top:10px;width: 100%;font-size: 1.4rem "><img src="{MODULE_URL}images/share.png" width=100%></div>
<div class="sthumb" style="">
<li class="row1">{$act['shortjj_']} {if strlen($act['shortjj'])>strlen($act['shortjj_'])}<a id="more" href="javascript:void(0)" class="more">详细</a>{/if}</li>
<li class="row2"><div class="rctbox" style="height: 60px;">
{loop $rctawarded $row}
<div class="awardedrow" style="text-align: center;line-height: 20px;">{$row['nickname']}&nbsp;抽中了&nbsp; {if $row['type']==1}红包{$row['redpack']}元{elseif $row['type']==2}裂变红包{$row['redpack']}元{elseif $row['type']==3}{$row['credit1']}积分{elseif $row['type']==4}{$row['title']}{/if}</div>
{/loop}
</div></li>
{if $msg['errno']>0}
<li class="row3">{$msg['message']}</li>
{/if}
</div>
</div>
<div id="timeoutlayer" class="layercontent"></div>
<div id="jjlayer" class="layercontent">
<span class="close_ close" data-target='fanallayer'><img src="{MODULE_URL}images/close.png" width="30" height="30"/></span> 
<div class="body">
<div>{$act['jj_']}</div>
</div>
</div>
<script>
wx.ready(function(){
require(['share'],function(modal){
	params={};
	modal.init(params);
	window.autoScroll=function(obj){ 
    $(obj).find(".rctbox").animate({ 
        marginTop : "-20px" 
    },500,function(){ 
        $(this).css({marginTop : "0px"}).find("div:first").appendTo(this); 
    })
	}
	setInterval("window.autoScroll('.row2')",1000);
		wx.getLocation({
		success: function (res) {
			$(window.currentlayer).hidelayer()
			//alert(JSON.stringify(res))
			var latitude = res.latitude;//手机端坐标res.latitude， 开发者工具坐标res.res.latitude // 纬度，浮点数，范围为90 ~ -90
			var longitude = res.longitude;
			window.longitude=longitude
	   		window.latitude=latitude
			script=document.createElement('script')
			script.src='http://api.map.baidu.com/api?v=1.5&ak=8qkuwVCdEna6zLwLdHWmgPAv&callback=mapCallback'
			head=document.head||document.getElementsByTagName('head')[0]
			document.body.appendChild(script)
		    script.onload = script.onreadystatechange=function(){
		   	if(!this.readyState || this.readyState=='loaded' || this.readyState=='complete'){
			}
	　　　　	}
			script.onload = script.onreadystatechange = null;
		},
		fail:function(res){
		{if $msg['errno']==0}
				if (dscanwarning){
					$(window.currentlayer).showlayer('请同意获取您的位置，请稍后...',location.href,3);
				}
		{/if}
			},
		cancel:function(res){
			{if $msg['errno']==0}
				if (dscanwarning){
					$(window.currentlayer).showlayer('请同意获取您的位置，请稍后...',location.href,3);
				}
				{/if}
				console.log('获取gps位置失败')
			//checkLocation()
			}
						})
		{if $msg['errno']==0}
		if (dscanwarning){
			$('#timeoutlayer').showlayer('正在获取您的位置信息,请稍后...','',false,false,'middle');
		}
		{/if}
});

			}
		)
function mapCallback(){
				var longitude,latitude,vdistrict;
				longitude=window.longitude,latitude=window.latitude;
				var point = new BMap.Point(longitude, latitude);    // 创建点坐标
									  var gc = new BMap.Geocoder(); //地址匹配类   
									  gc.getLocation(point, function(rs){
									  			city=rs.addressComponents.city;
									  			district=rs.addressComponents.district;
									  			province=rs.addressComponents.province;
									  			street=rs.addressComponents.street;
									  			streetNumber=rs.addressComponents.streetNumber;
												setCookie('city',city);	 
												setCookie('district',district);	 
												setCookie('province',province);
												setCookie('street',street);
												setCookie('streetnum',streetNumber);
												setCookie('address',rs.address);
												if (typeof districtarr!='undefined'&&(dscanwarning)){
													vdistrict=false
													for(a in districtarr){
													if (rs.address.indexOf(districtarr[a])!=-1){
														vdistrict=true
														break;
													}
													}
												}
												if (scanid){
													url='{php echo $this->createmobileurl('location',array('actid'=>$act['id'],'scanid'=>$_GPC['scanid']))}'
													if (typeof vdistrict!='undefined'){
														url=url+'&vdistrict='+vdistrict.toString()
													}
													//alert(url)
													$.ajax({
														type:'get',
														dataType:'json',
														url:url,
														success:function(data){
															console.log(data.message)
														},
														error:function(a,b,c){
															alert(b)
														},
													})
												}
								  	 })
}

</script>
{template 'footer'}
